import{a as R,r as i,j as e}from"./index-CEwMMO6D.js";import{s as c}from"./SupaBase-DdafNSpo.js";/* empty css                      */import{N as U}from"./NavBar-DkS9Kew_.js";import B from"./DoctorsSidebar-C92mAtLM.js";import{Q as z,B as n}from"./react-toastify.esm-CPfoCFDA.js";/* empty css                      */import{E as O}from"./Edit-D7SR9c48.js";/* empty css               */import"./createSvgIcon-ksZbkFwt.js";/* empty css                       */import"./Close-MmRdREOg.js";import"./ChecklistRtl-DqAmTbcq.js";const re=()=>{const{id:l}=R();console.log(l);const[s,j]=i.useState(null),[C,h]=i.useState(!0),[x,P]=i.useState(null),[d,D]=i.useState(null),[u,v]=i.useState(""),[m,N]=i.useState(""),[w,p]=i.useState(!1),[_,A]=i.useState(0),[f,y]=i.useState(null),[I,E]=i.useState(null);i.useEffect(()=>{(async()=>{try{const{data:r,error:t}=await c.from("DoctorsData").select().eq("id",l).single();if(t)throw new Error("Error fetching doctor data");j(r),D(r.image_url),E(r.image_url),v(r.address||""),N(r.Degree||"")}catch(r){P(r.message)}finally{h(!1)}})()},[l]);const $=async a=>{const r=a.target.files[0];if(!r){n.error("No file selected.");return}const t=`doctor_${l}_${r.name.replace(/\s+/g,"_")}`;try{const{error:o}=await c.storage.from("Doctors-profile-pic").upload(t,r,{upsert:!0});if(o)throw o;const{data:L,error:S}=c.storage.from("Doctors-profile-pic").getPublicUrl(t);if(S)throw S;const g=L.publicUrl,{error:b}=await c.from("DoctorsData").update({image_url:g}).eq("id",l);if(b)throw b;D(g),E(g),n.success("Profile picture updated successfully!")}catch(o){console.error("Error handling image change:",o.message),n.error(`Failed to update profile picture: ${o.message}`)}},k=async()=>{if(!(u!==(s==null?void 0:s.address)||m!==(s==null?void 0:s.Degree)||d!==(s==null?void 0:s.image_url))){n.info("No changes detected.");return}h(!0);try{const{data:r,error:t}=await c.from("DoctorsData").update({address:u,Degree:m,image_url:d}).eq("id",l);if(t)throw t;j(o=>({...o,address:u,Degree:m,image_url:d})),n.success("Details updated successfully!"),p(!1)}catch(r){console.error("Error updating details:",r.message),n.error(`Failed to update details: ${r.message}`)}finally{h(!1)}},q=async a=>{let r;a===0&&(r="info"),a===1&&(r="DoctorAwards"),a===2&&(r="Research");try{const{data:t,error:o}=await c.from("DoctorsData").select(r).eq("id",l).single();if(o)throw o;y(t[r])}catch(t){console.error("Error fetching section data:",t.message),y(null)}},F=a=>{A(a),q(a)};return C?e.jsx("div",{children:"Loading..."}):x?e.jsx("div",{style:{color:"red"},children:x}):e.jsxs(e.Fragment,{children:[e.jsx(U,{profileImage:I}),e.jsx(B,{id:l}),e.jsxs("div",{className:"single-doctor-data",children:[e.jsxs("div",{className:"profile-header",children:[d&&e.jsx("img",{src:d,alt:"Doctor"}),e.jsxs("div",{className:"profile-details",children:[e.jsx("h2",{children:(s==null?void 0:s.name)||"Doctor Name"}),e.jsx("p",{children:(s==null?void 0:s.Designation)||"Specialization"}),e.jsx("p",{children:(s==null?void 0:s.Degree)||"Degree"}),e.jsx("p",{children:(s==null?void 0:s.address)||"Address"}),e.jsx("p",{children:(s==null?void 0:s.Language)||"Language"})]}),e.jsx("button",{onClick:()=>p(!0),children:e.jsx(O,{})})]}),e.jsxs("div",{className:"info",children:[e.jsx("div",{className:"info-buttons",children:["Overview","Doctors Awards","Research"].map((a,r)=>e.jsx("button",{className:_===r?"active1":"",onClick:()=>F(r),children:a},r))}),e.jsx("div",{className:"info-content",children:f?Array.isArray(f)?e.jsx("ul",{children:f.map((a,r)=>e.jsx("li",{children:a},r))}):e.jsx("div",{children:f}):e.jsx("p",{children:"Select a section to view details."})})]}),e.jsx(z,{})]}),w&&e.jsx("div",{className:`popform ${w?"show":""}`,children:e.jsxs("div",{className:"popform-content",children:[e.jsxs("div",{className:"popform-header",children:[e.jsx("h3",{children:"Edit Doctor Details"}),e.jsx("button",{onClick:()=>p(!1),children:"Close"})]}),e.jsxs("div",{className:"popform-body",children:[e.jsxs("div",{className:"editable-field",children:[e.jsx("label",{children:"Address:"}),e.jsx("input",{type:"text",value:u,onChange:a=>v(a.target.value)})]}),e.jsxs("div",{className:"editable-field",children:[e.jsx("label",{children:"Degree:"}),e.jsx("input",{type:"text",value:m,onChange:a=>N(a.target.value)})]}),e.jsxs("div",{className:"editable-field",children:[e.jsx("label",{children:"Profile Picture:"}),e.jsx("input",{type:"file",accept:"image/*",onChange:$})]})]}),e.jsx("div",{className:"popform-footer",children:e.jsx("button",{onClick:k,children:"Save"})})]})})]})};export{re as default};
