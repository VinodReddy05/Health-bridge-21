import{r as s,j as e}from"./index-C8N-Qaqw.js";import{s as d}from"./SupaBase-hXybzm9P.js";import{N as w}from"./NavBar-DrSRVsRg.js";/* empty css               */import"./createSvgIcon-UnPMeLsY.js";import"./react-toastify.esm-Cs-6VpAC.js";const A=()=>{const[p,j]=s.useState([]),[u,h]=s.useState(!0),[o,f]=s.useState(null),[y,l]=s.useState(!1),[n,b]=s.useState(null),[a,m]=s.useState(""),g=async()=>{try{h(!0);const t=JSON.parse(localStorage.getItem("doctorData"));if(!t)throw console.log("Doctor Details:",t),new Error("Doctor not logged in");const{id:r,Designation:i}=t,{data:c,error:x}=await d.from("Appointments").select("*").or(`doctor_id.eq.${r},doctor_designation.eq.${i}`).order("date_time",{descending:!0});if(x)throw x;j(c)}catch(t){f(t.message)}finally{h(!1)}},S=async(t,r)=>{try{const{error:i}=await d.from("Appointments").delete().eq("id",t);if(i)throw i;const{error:c}=await d.from("patientsdata").upsert([{id:r,visited:!0}]);if(c)throw c;g(),alert("Patient marked as visited.")}catch(i){alert("Error marking patient as visited: "+i.message)}},v=async t=>{if(t.preventDefault(),!n||!a.trim()){alert("Please provide prescription details.");return}try{const{error:r}=await d.from("patientsdata").update({prescription:a}).eq("id",n.patient_id);if(console.log("Updating Patient:",n.patient_id),console.log("Prescription:",a),r)throw r;alert("Prescription sent successfully!"),l(!1),m("")}catch(r){alert("Error sending prescription: "+r.message)}};return s.useEffect(()=>{g()},[]),o?e.jsxs("p",{children:["Error: ",o]}):e.jsxs("div",{className:"appointments",children:[e.jsx(w,{}),e.jsx("h1",{children:"My Patients"}),u?e.jsxs("div",{className:"loading",children:[e.jsx("p",{children:"Loading appointments..."}),e.jsx("img",{src:"https://media.giphy.com/media/swhRkVYLJDrCE/giphy.gif?cid=ecf05e479be0lrxrenydhqbicxcxjax3r27oecws4y4i8x6u&ep=v1_gifs&rid=giphy.gif&ct=g",alt:"Loading..."})]}):o?e.jsxs("p",{className:"error-message",children:["Error: ",o]}):p.length===0?e.jsx("p",{className:"no-appointments",children:"No patients found."}):e.jsx("ul",{children:p.map(t=>e.jsxs("li",{children:[e.jsxs("div",{className:"date",children:[e.jsxs("p",{style:{color:"red",fontWeight:"bold"},children:[e.jsx("strong",{children:"Date: "})," ",new Date(t.date_time).toLocaleDateString()]}),e.jsxs("p",{style:{color:"red",fontWeight:"bold"},children:[e.jsx("strong",{children:"Time: "})," ",new Date(t.date_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("p",{style:{color:"green",fontWeight:"bold"},children:[e.jsx("strong",{children:"Doctor Name: "})," ",t.doctor_name]}),e.jsxs("p",{style:{color:"grey",fontWeight:"bold"},children:[e.jsx("strong",{children:"Doctor ID: "}),t.doctor_id]}),e.jsxs("p",{style:{color:"#EB8317",fontWeight:"bold"},children:[e.jsx("strong",{children:"Patient Name: "}),t.patient_name]}),e.jsxs("p",{style:{color:"grey",fontWeight:"bold"},children:[e.jsx("strong",{children:"Patient ID: "}),t.patient_id]}),e.jsxs("div",{className:"prescription-btns",children:[e.jsx("button",{onClick:()=>{b(t),l(!0)},children:"Send Prescription"}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:`visited-${t.id}`,onChange:()=>S(t.id,t.patient_id)}),"Mark as Visited"]})]})]},t.id))}),y&&e.jsx("div",{className:"prescription-form",children:e.jsxs("div",{className:"form-container",children:[e.jsx("h2",{children:"Send Prescription"}),e.jsxs("form",{onSubmit:v,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Patient: "}),n.patient_name]}),e.jsx("textarea",{value:a,onChange:t=>m(t.target.value),placeholder:"Write the prescription here..."}),e.jsx("button",{type:"submit",children:"Send"}),e.jsx("button",{type:"button",onClick:()=>l(!1),children:"Cancel"})]})]})})]})};export{A as default};
