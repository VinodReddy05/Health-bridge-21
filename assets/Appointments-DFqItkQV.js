import{r as a,j as e}from"./index-CEwMMO6D.js";import{s as o}from"./SupaBase-DdafNSpo.js";import{N as A}from"./NavBar-DkS9Kew_.js";import{Q as E,B as r}from"./react-toastify.esm-CPfoCFDA.js";/* empty css                      *//* empty css               */import"./createSvgIcon-ksZbkFwt.js";const z=()=>{const[c,l]=a.useState(null),[d,m]=a.useState([]),[n,u]=a.useState(null),[p,h]=a.useState(""),[S,x]=a.useState(!1),[j,b]=a.useState("");a.useEffect(()=>{const t=JSON.parse(localStorage.getItem("patientData"));t&&t.name&&b(t.name)},[]);const v=async()=>{const{data:t,error:s}=await o.from("DoctorsData").select();s?(l("Could not fetch data"),m([])):(m(t),l(null))};a.useEffect(()=>{v()},[]);const _=t=>{u(t),x(!0)},g=()=>{x(!1),u(null),h("")},w=async()=>{if(!p){r.error("Please select a date and time for the appointment.");return}const t=JSON.parse(localStorage.getItem("patientData"));if(console.log("Retrieved patient_data:",t),!t||!t.id||isNaN(t.id)){r.error("Patient ID is not available or invalid.");return}const s=t.id;if(!n){r.error("No doctor selected.");return}try{const{data:i,error:f}=await o.from("Appointments").insert([{patient_id:s,doctor_id:n.id,date_time:p,doctor_name:n.name,doctor_image:n.image_url,doctor_specialization:n.Degree,doctor_designation:n.Designation,patient_name:j}]).select();if(f){console.error(f),r.error("Error scheduling appointment. Please try again.");return}const{error:N}=await o.from("DoctorsData").update({appointments:i}).eq("id",n.id);N&&(console.error(N),r.warning("Appointment scheduled, but doctor details were not updated."));const{error:D}=await o.from("patientsdata").update({appointments:i}).eq("id",s);D&&(console.error(D),r.warning("Appointment scheduled, but patient details were not updated.")),r.success("Appointment scheduled successfully!"),g()}catch(i){console.error(i),r.error("An unexpected error occurred.")}};return e.jsxs("div",{className:"toggle",children:[e.jsx(A,{}),c&&e.jsx("p",{children:c}),d&&e.jsx("div",{className:"doctors-card",children:d.map((t,s)=>e.jsxs("div",{className:"doctor-info-card",children:[e.jsx("img",{src:t.image_url,alt:t.name}),e.jsx("p",{children:e.jsx("strong",{children:t.name})}),e.jsx("p",{style:{color:"red"},children:e.jsx("b",{children:t.Designation})}),e.jsx("p",{children:e.jsx("b",{children:t.Degree})}),e.jsx("p",{children:t.info}),e.jsx("button",{className:"appointmentbtn",onClick:()=>_(t),children:"Get Appointment"})]},s))}),S&&e.jsx("div",{className:"appointment-popup",children:e.jsxs("div",{className:"popup-content",children:[e.jsx("h3",{children:"Schedule an Appointment"}),e.jsx("img",{src:n==null?void 0:n.image_url,alt:n==null?void 0:n.name,style:{width:"100px",height:"100px",borderRadius:"50%"}}),e.jsxs("p",{children:[e.jsx("strong",{children:"Doctor:"})," ",n==null?void 0:n.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Specialization:"})," ",n==null?void 0:n.Degree]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Designation:"})," ",n==null?void 0:n.Designation]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Patient Name:"})," ",j]}),e.jsxs("label",{children:[e.jsx("strong",{children:"Date and Time:"}),e.jsx("input",{type:"datetime-local",value:p,onChange:t=>h(t.target.value)})]}),e.jsxs("div",{className:"popup-actions",children:[e.jsx("button",{onClick:w,children:"Confirm"}),e.jsx("button",{onClick:g,children:"Cancel"})]})]})}),e.jsx(E,{})]})};export{z as default};
